var log = console.log;

exports.route = function(ctrl_path,view_path,req,res){
	var url = req.url.split('?')[0],m = null;
	if (url === '/') {
		return require(ctrl_path).index(req,res);
	};
	if (m = url.match(/^\/([\w_]+)\/$/)) {
		var ctrl = ctrl_path + m[1];
		try{
			ctrl = require(ctrl_path+'/'+m[1]);
		}catch(e){
			log('None exists controller ' + m[1] + ' is accessed');
			return res.end('404');
		}
		ctrl.index(req,res);
	};
	if (m = url.match(/^\/([\w_]+)\/([\w_]+)\/$/)) {
		var ctrl = ctrl_path+'/'+m[1],
			action = m[2];
		try{
			ctrl = require(require(ctrl));
		}catch(e){
			log('None exists controller ' + m[1] + ' is accessed');
			return res.end('404');
		}
		if (!ctrl[action]) {
			log('None exists action ' + m[1] + '/' + m[2] + ' is accessed');
			return res.end('404');
		};
		ctrl[action](req,res);
	};
	if (m = url.match(/^\/([\w_]+)\/([\w_]+)\/([\w_]+)\/$/)) {
		var ctrl = ctrl_path+'/'+m[1],
			action = m[2];
		try{
			ctrl = require(require(ctrl));
		}catch(e){
			log('None exists controller ' + m[1] + ' is accessed');
			return res.end('404');
		}
		if (!ctrl[action]) {
			log('None exists action ' + m[1] + '/' + m[2] + ' is accessed');
			return res.end('404');
		};
		ctrl[action](req,res,m[3]);
	};
};